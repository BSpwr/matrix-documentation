<!--
  This Basic theme serves as an example for how to create other
  themes by demonstrating the features with minimal HTML and CSS.
  Comments like this will be through the code to explain briefly
  what each feature is and point you to the MkDocs documentation
  to find out more.
-->
<!DOCTYPE html>
<head>

  <!--
    The page_title contains the title for a page as shown in the navigation.
    Site name contains the name as defined in the mkdocs.yml
  -->
  <title>Microphone - MATRIX</title>

  <!--
    Support custom favicon support.
    http://www.mkdocs.org/user-guide/configuration/#site_favicon
  -->
  
    <link rel="shortcut icon" href="../../img/favicon.ico">
  

  <!--
    You can include external assets of course, but be aware that it means the
    documentation may not work well offline.
  -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <link rel="stylesheet" href="../../css/theme.css">
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet">
  <!--
    extra_ess contains paths to CSS files in the users
    documentation directory or a list of CSS files defined in
    their mkdocs.yml.

    http://www.mkdocs.org/user-guide/configuration/#extra_css
  -->
  
    <link href="../../styles.css" rel="stylesheet">
  

  <!--
    To include static assets from our theme, just add
    ../.. beforehand which will be the relative path to
    the root of the documentation.
  -->
  <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  <script src="../../js/theme.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!--
    extra_javascript contains paths to JavaScript files in the
    users documentation directory or a list of JavaScript files
    defined in their mkdocs.yml.

    http://www.mkdocs.org/user-guide/configuration/#extra_javascript
  -->
  

  <!--
    Include Google Analytics tracking code.

    http://www.mkdocs.org/user-guide/configuration/#google_analytics
  -->
  

  
  
</head>
<body>
  <!--
    Create the navigation for the documentation.

    Because we don't know how many levels deep the navigation is, it needs to
    be included in it's own file so it can be recursive. Otherwise the theme
    can also only support a specific number of levels.

    See the nav.html file for more details about how this works.
  -->
<nav class="navbar navbar-default">
  <div class="container">
    <a class="navbar-brand" href="../..">
      <img alt="MATRIX Labs" src="../../img/matrix.png">
    </a>
    <ul class="nav navbar-nav">
    
    
      <!--

-->

<li >
    <a href="../..">Installation</a>
</li>

    
      <!--

-->

<li >
    <a href="../../upgrades/">Upgrades</a>
</li>

    
      <!--

-->

  
  <li class="dropdown">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">MATRIX CLI <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../CLI/overview/">Overview</a>
</li>

        
            <!--

-->

<li >
    <a href="../../CLI/installation/">Installation</a>
</li>

        
            <!--

-->

<li >
    <a href="../../CLI/apps/">Apps</a>
</li>

        
            <!--

-->

<li >
    <a href="../../CLI/device/">Devices</a>
</li>

        
            <!--

-->

<li >
    <a href="../../CLI/example/">Examples</a>
</li>

        
            <!--

-->

<li >
    <a href="../../intro/cli-troubleshooting/">Troubleshooting</a>
</li>

        
    </ul>
  </li>

    
      <!--

-->

  
  <li class="dropdown">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">MATRIX OS <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../API/overview/">Overview</a>
</li>

        
            <!--

-->

<li >
    <a href="../../intro/app-publishing/">App Publishing</a>
</li>

        
            <!--

-->

  
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">App API <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../API/sensors/">Sensors</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/everloop/">Everloop</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/filter/">Filters</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/computer-vision/">Computer Vision</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/microphone/">Microphone</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/crosstalk/">Cross-Talk</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/typesend/">Type</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/GPIO/">GPIO</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/ir/">IR TX/RX</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/nfc/">NFC</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/zwave/">Z-wave</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/zigbee/">Zigbee</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/servos/">Servos</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/file-storage/">File Storage</a>
</li>

        
            <!--

-->

<li >
    <a href="../../API/db/">Local Database</a>
</li>

        
    </ul>
  </li>

        
            <!--

-->

  
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Configuration <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../Configuration/overview/">Overview</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/datatypes/">Datatypes</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/screens/">Screens</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/filters/">Filters</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/widgets/">Widgets</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/services/">Services</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/example-config/">Config File</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Configuration/examples/">Widget Examples</a>
</li>

        
    </ul>
  </li>

        
            <!--

-->

<li >
    <a href="../../intro/matrix-troubleshooting/">Troubleshooting</a>
</li>

        
    </ul>
  </li>

    
      <!--

-->

  
  <li class="dropdown">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Hardware <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../Reference/creator/">Creator</a>
</li>

        
            <!--

-->

<li >
    <a href="../../Reference/voice/">Voice</a>
</li>

        
            <!--

-->

  
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">HAL <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../HAL/overview/">Overview</a>
</li>

        
            <!--

-->

<li >
    <a href="../../HAL/overview/">Examples</a>
</li>

        
            <!--

-->

<li >
    <a href="../../HAL/troubleshooting/">Troubleshooting</a>
</li>

        
    </ul>
  </li>

        
            <!--

-->

  
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">MALOS <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../MALOS/overview/">Overview</a>
</li>

        
            <!--

-->

<li >
    <a href="../../MALOS/example/">Examples</a>
</li>

        
            <!--

-->

<li >
    <a href="../../MALOS/troubleshooting/">Troubleshooting</a>
</li>

        
    </ul>
  </li>

        
            <!--

-->

<li >
    <a href="../../Reference/pinout/">Pinout</a>
</li>

        
            <!--

-->

<li >
    <a href="../fpga/">FPGA</a>
</li>

        
            <!--

-->

<li >
    <a href="../Sam3/">SAM3</a>
</li>

        
            <!--

-->

<li >
    <a href="../sam3mcu-programming/">SAM3MCU</a>
</li>

        
            <!--

-->

<li class="active">
    <a href="./">Microphone</a>
</li>

        
            <!--

-->

<li >
    <a href="../SPI/">SPI</a>
</li>

        
    </ul>
  </li>

    
      <!--

-->

  
  <li class="dropdown">
    <a href="#" class="dropdown-toggle submenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Demos <span class="caret"></span></a>
    <ul class="dropdown-menu">
        
            <!--

-->

<li >
    <a href="../../Demos/Alexa/">Alexa on Creator</a>
</li>

        
    </ul>
  </li>

    
      <!--

-->

<li >
    <a href="../../dictionary/">Dictionary</a>
</li>

    
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li><a class="order" href="https://creator.matrix.one" target="_blank">Order Dev Kit</a></li>
    </ul>
  </div>
</nav>
  <div class="jumbotron">
    
    <h1 class="text-center">Microphone</h1>
    
  </div>
  <div class="container">
    <div class="row">
      <div class="col-md-2">
        
        <h3>Search</h3>
          <!--
            Create a search form that sends the user to the search.html file - this is
            the other file in the template which adds search to the theme. The only
            requirement here is that there is a text input with the name 'q' and the
            action and methods match below.
          -->
          <div role="search">
            <form action="../../search.html" method="get">
              <div class="form-group">
                <input class="form-control" type="search" name="q" placeholder="Search docs" />
              </div>
            </form>
          </div>

          
          <!--
            Implement the previous and next links to cycle through the pages.
          -->
          
          
          <div id="nav-ctrls" style="display: none">
          <hr/>
          <h3>Navigation</h3>
            <div>
              
                <a href="../sam3mcu-programming/" class="btn btn-default" title="SAM3MCU"><span aria-hidden="true">&laquo;</span> prev.</a>
              
              
                <a href="../SPI/" class="btn btn-default" title="SPI"/> next <span aria-hidden="true">&raquo;</span></a>
              
            </div>
            <hr/>
          </div>
          

          
          <h3>Contents</h3>
          <ul class="list-group">
          
              <li class="list-group-item"><a href="#microphone">Microphone</a></li>
              
                  <li class="list-group-item"><a href="#1-mic-array-on-matrix-creator">1. Mic Array on MATRIX Creator</a></li>
              
                  <li class="list-group-item"><a href="#2-how-to-get-microphone-data-from-c">2. How to get microphone data from C++</a></li>
              
                  <li class="list-group-item"><a href="#3-example-demo-apps-for-mics">3. Example demo apps for mics</a></li>
              
                  <li class="list-group-item"><a href="#record-convert-and-play-sounds">Record, Convert and Play sounds.</a></li>
              
          
          </ul>

          

      </div>
      <div class="col-md-10">
        
          <h3 id="microphone">Microphone</h3>
<h4 id="1-mic-array-on-matrix-creator">1. Mic Array on MATRIX Creator</h4>
<p><a href="https://github.com/matrix-io/matrix-documentation/blob/yc/improving_mic_doc/docs/Hardware/mic_position.png?raw=true"><img src="https://github.com/matrix-io/matrix-documentation/blob/yc/improving_mic_doc/docs/Hardware/mic_position.png?raw=true" align="center"  ></a></p>
<h5 id="position-xy-of-each-mic-in-the-array">Position [x,y] of each mic in the array:</h5>
<table>
<thead>
<tr>
<th>Mic</th>
<th>X</th>
<th>Y</th>
</tr>
</thead>
<tbody>
<tr>
<td>M1</td>
<td>20.0908795</td>
<td>-48.5036755</td>
</tr>
<tr>
<td>M2</td>
<td>-20.0908795</td>
<td>-48.5036755</td>
</tr>
<tr>
<td>M3</td>
<td>-48.5036755</td>
<td>-20.0908795</td>
</tr>
<tr>
<td>M4</td>
<td>-48.5036755</td>
<td>20.0908795</td>
</tr>
<tr>
<td>M5</td>
<td>-20.0908795</td>
<td>48.5036755</td>
</tr>
<tr>
<td>M6</td>
<td>20.0908795</td>
<td>48.5036755</td>
</tr>
<tr>
<td>M7</td>
<td>48.5036755</td>
<td>20.0908795</td>
</tr>
<tr>
<td>M8</td>
<td>48.5036755</td>
<td>-20.0908795</td>
</tr>
</tbody>
</table>
<h5 id="connection-to-the-fpga">Connection to the FPGA</h5>
<p>from the <a href="https://github.com/matrix-io/matrix-creator-fpga/blob/master/creator_core/creator.ucf">creator.ucf</a> :</p>
<table>
<thead>
<tr>
<th>Mic</th>
<th>FPGA pin</th>
<th>PDM_Data</th>
</tr>
</thead>
<tbody>
<tr>
<td>M1</td>
<td>P45</td>
<td>pdm_data&lt;0&gt;</td>
</tr>
<tr>
<td>M2</td>
<td>P46</td>
<td>pdm_data&lt;1&gt;</td>
</tr>
<tr>
<td>M3</td>
<td>P47</td>
<td>pdm_data&lt;2&gt;</td>
</tr>
<tr>
<td>M4</td>
<td>P58</td>
<td>pdm_data&lt;3&gt;</td>
</tr>
<tr>
<td>M5</td>
<td>P59</td>
<td>pdm_data&lt;4&gt;</td>
</tr>
<tr>
<td>M6</td>
<td>P64</td>
<td>pdm_data&lt;5&gt;</td>
</tr>
<tr>
<td>M7</td>
<td>P65</td>
<td>pdm_data&lt;6&gt;</td>
</tr>
<tr>
<td>M8</td>
<td>P44</td>
<td>pdm_data&lt;7&gt;</td>
</tr>
<tr>
<td>CLK</td>
<td>P47</td>
<td>pdm_clk</td>
</tr>
</tbody>
</table>
<h5 id="audio-specs">Audio specs:</h5>
<p>Sample Rate: 16 kHz
Bit Depth: 16 bit</p>
<p><strong>Note</strong>: An option for setting higher sample rates will be released soon.  Please keep in touch in the community announcements channel http://community.matrix.one/c/announcements.</p>
<h5 id="microphones-datasheet">Microphones Datasheet:</h5>
<p><a href="http://www.st.com/content/ccc/resource/technical/document/datasheet/57/af/88/31/7b/59/4f/77/DM00111225.pdf/files/DM00111225.pdf/jcr:content/translations/en.DM00111225.pdf">MP34DB02 - MEMS audio sensor omnidirectional digital microphone</a> </p>
<h4 id="2-how-to-get-microphone-data-from-c">2. How to get microphone data from C++</h4>
<p>You can use our lower software layer in C++ called HAL () (Hardware Abstraction Layer) to read data from the microphones.</p>
<h5 id="getting-and-compiling-hal">Getting and Compiling HAL</h5>
<pre><code>git clone https://github.com/matrix-io/matrix-creator-hal.git
cd matrix-creator-hal 
mkdir build &amp;&amp; cd build
cmake ..
make
</code></pre>
<h5 id="example-code">Example code</h5>
<p>The following example gets samples from all channels (mics) collected by the fpga.  </p>
<pre><code>... 
int main() {
    hal::WishboneBus bus;
    bus.SpiInit();
    hal::MicrophoneArray mics;
    mics.Setup(&amp;bus);
    std::valarray&lt;float&gt; magnitude(mics.Channels());

    mics.SetGain(8);
    std::cout &lt;&lt; "M1\t" &lt;&lt; "M2\t" &lt;&lt; "M3\t" &lt;&lt; "M4\t" &lt;&lt; "M5\t" &lt;&lt; "M6\t" &lt;&lt; "M7\t" &lt;&lt; "M8\t" &lt;&lt; std::endl;

    while (true) {
        mics.Read();
        magnitude = 0.0;
        for (unsigned int s = 0; s &lt; mics.NumberOfSamples(); s++) {
            for (unsigned int c = 0; c &lt; mics.Channels(); c++) {
              magnitude[c] = mics.At(s, c);
              std::cout &lt;&lt;  magnitude[c] &lt;&lt; "\t";
            }
            std::cout &lt;&lt; std::endl;
        }
    }
    return 0;
}
</code></pre>
<h4 id="3-example-demo-apps-for-mics">3. Example demo apps for mics</h4>
<p>The demo apps are in the folder <code>matrix-creator-hal/demos/</code> . They are built with HAL. To run them go to the demo folder :</p>
<pre><code>cd build/demos
./mic_demo
</code></pre>
<p>note: You can play with the demos to learn how to use HAL, and them use them as starting points for your own apps.</p>
<h5 id="mic_demo">mic_demo</h5>
<p>This demo maps each mic audio input to one specific led on the Everloop. You can make sounds close to the MATRIX Creator and see how the LEDs turn green when a sound is detected. Also the demo prints in the terminal the audio as numbers, e.g.:</p>
<pre><code>cd build/demos
./mic_demo
0   0   0   0   0   0   0   0   
0   0   0   0   0   0   0   0   
6   6   6   6   6   4   5   6   
3   6   4   4   2   2   2   2   
0   0   0   0   0   0   0   0   
0   0   0   0   0   0   0   0   
0   0   0   0   0   0   0   0   
3   5   5   4   4   4   5   4   
5   6   6   6   6   5   6   5   
1   0   1   2   2   1   1   1   
0   1   1   1   1   1   1   1   
0   1   1   0   1   0   0   0   
...
</code></pre>
<h5 id="mic_energy">mic_energy</h5>
<p>This demo is similar but instead of mapping the mic's audio individually takes all channels and maps the average of all mics. It maps at the same time in all LEDs and creates a very voice responsive red light. This demos does not print anything on the terminal.</p>
<pre><code>cd build/demos
./mic_energy
</code></pre>
<h5 id="micarray_recorder">micarray_recorder</h5>
<p>This demo records audio from all 8 channels (0-7) and the beamforming channel (channel 8) to raw files located in the same folder. After you launching the demo you will have these files:</p>
<pre><code>cd build/demos
./micarray_recorder
</code></pre>
<p>The default example records audio to raw files for 10 seconds and then stops. After recording the files are on the same folder <code>/demos</code> :</p>
<pre><code>cd build/demos
ls | grep raw
mic_16000_s16le_channel_0.raw
mic_16000_s16le_channel_1.raw
mic_16000_s16le_channel_2.raw
mic_16000_s16le_channel_3.raw
mic_16000_s16le_channel_4.raw
mic_16000_s16le_channel_5.raw
mic_16000_s16le_channel_6.raw
mic_16000_s16le_channel_7.raw
mic_16000_s16le_channel_8.raw
</code></pre>
<p>note: The data in the raw files is written in <code>int16_t</code>. </p>
<h5 id="direction_of_arrival_demo">direction_of_arrival_demo</h5>
<p>This demo shows a first implementation of direction of arrival detection. It shows the direction of arrival using the LEDs and also prints the result angle in the terminal. To test it run the demo and make sounds from different directions to the MATRIX Creator board to see how. </p>
<pre><code>./direction_of_arrival_demo
azimutal angle = 0, polar angle = 0, mic = 0
azimutal angle = 0, polar angle = 0, mic = 0
azimutal angle = -157.5, polar angle = 18, mic = 2
azimutal angle = -157.5, polar angle = 18, mic = 2
azimutal angle = -157.5, polar angle = 18, mic = 2
azimutal angle = 22.5, polar angle = 36, mic = 6
azimutal angle = -157.5, polar angle = 54, mic = 2
azimutal angle = -157.5, polar angle = 72, mic = 2
azimutal angle = -157.5, polar angle = 72, mic = 2
</code></pre>
<h4 id="record-convert-and-play-sounds">Record, Convert and Play sounds.</h4>
<h5 id="update-and-upgrade-raspbian">Update and upgrade Raspbian</h5>
<pre><code>sudo apt-get update
sudo apt-get upgrade
</code></pre>
<h5 id="install-alsa-tools-and-the-sox-utility">Install <em>Alsa tools</em> and the <em>sox</em> utility</h5>
<pre><code>sudo apt-get install sox alsa-utils
</code></pre>
<h5 id="run-the-volume-control">Run the volume control</h5>
<pre><code>alsamixer
</code></pre>
<h5 id="run-capture-and-check-the-recorded-files">Run capture and check the recorded files</h5>
<pre><code>cd demos
./micarray_recorder
ls -1 *raw
</code></pre>
<h5 id="convert-the-audio">Convert the audio</h5>
<pre><code>sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_0.raw channel_0.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_1.raw channel_1.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_2.raw channel_2.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_3.raw channel_3.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_4.raw channel_4.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_5.raw channel_5.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_6.raw channel_6.wav
sox -r 16000 -c 1 -e signed -c 1 -e signed -b 16 mic_16000_s16le_channel_7.raw channel_7.wav
</code></pre>
<h5 id="play-the-wav-file-ie-audio-from-channel-0">Play the wav file (i.e. audio from channel 0)</h5>
<pre><code>aplay channel_0.wav
</code></pre>
        
      </div>
    </div>
  </div>

  <!--
  MkDocs version      : 0.16.1
  Docs Build Date UTC : 2017-05-26 17:49:34
  -->

</body>
</html>
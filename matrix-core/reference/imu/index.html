<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IMU MATRIX</title>
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../css/theme.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="/">
    <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar-menu">
    <ul class="navbar-nav ml-auto">
      <!-- <li class="nav-item">
        <a class="nav-link">
          For Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Creator
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Voice
        </a>
      </li>
      <li class="nav-item">
        <a href="https://apps.matrix.one/" target="blank" class="nav-link">
          Apps
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Store
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          OS
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link active">
          Developers
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="/img/english.png" alt="English">
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="#">
            <span>Português</span>
            <img src="/img/brazil.png" alt="Portuguese" />
          </a>
          <a class="dropdown-item" href="#">
            <span>Español</span>
            <img src="/img/spain.png" alt="Spanish" />
          </a>
        </div>
      </li> -->
    </ul>
  </div>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>IMU</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../../../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <h3>Documentation</h3>
          <ul>
              

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../.." class="">
    Overview
  </a>
</li>


  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../setup/" class="">
    Device Setup
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-os/" class="">
    MATRIX OS
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/overview/" class="">
      Overview
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-os/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../" class="active">
    MATRIX CORE
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../examples/pytests/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../everloop/" class="active">
      Reference
    </a>
  </li>

  <ul class="subnav">
      
    
    <li><a href="../everloop/" class="">Everloop</a></li>
        
    
    <li><a href="../gpio/" class="">GPIO</a></li>
        
    
    <li><a href="../humidity/" class="">Humidity</a></li>
        
    
    <li><a href="./" class="active">IMU</a></li>
        
    
    <li><a href="../lirc/" class="">IR</a></li>
        
    
    <li><a href="../pressure/" class="">Pressure</a></li>
        
    
    <li><a href="../servo/" class="">Servo</a></li>
        
    
    <li><a href="../UV/" class="">UV</a></li>
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-hal/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/getting-started/installation/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/datasheets/creator/" class="">
      Boards
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/components/" class="">
      Components
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/tools/" class="">
      Tools
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/examples/alexa/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-hal/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../help/" class="">
    Support
  </a>
</li>


 
          </ul>
        </div>
        <div id="content"  class="col-lg-8">
           <h1 id="inertial-measurement-unit-imu">Inertial Measurement Unit - IMU</h1>
<p>The IMU driver reports values for:</p>
<ul>
<li>Yaw Axis or normal axis</li>
<li>Pitch Axis or lateral axis</li>
<li>Roll Axis or longitudinal axis</li>
</ul>
<p>The driver follows the <a href="../../#protocol">CORE protocol</a>.</p>
<h3 id="0mq-port">0MQ Port</h3>
<pre><code>20013
</code></pre>

<h3 id="protocol-buffers">Protocol buffers</h3>
<pre><code>message Imu {
  float yaw = 1;
  float pitch = 2;
  float roll = 3;
}
</code></pre>

<p>The message is defined in <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>.</p>
<h3 id="keep-alives">Keep-alives</h3>
<p>This driver needs keep-alive messages <a href="https:////github.com/matrix-io/matrix-creator-malos/blob/master/README.md#keep-alive-port">as specified in the CORE protocol</a>.
If you start sending keep-alive messages it will start returning data every second so you can omit the configuration for this device.</p>
<h3 id="errors">Errors</h3>
<p>This driver report errors when an invalid configuration is sent.</p>
<h3 id="read">Read</h3>
<p>The driver will send a serialized message of type<code>IMU</code>.</p>
<pre><code>message Imu {
  float yaw = 1;
  float pitch = 2;
  float roll = 3;
}
</code></pre>

<p>This is a sample output given by the example described below.</p>
<pre><code>$ node test_imu.js 
Sending pings every 5 seconds
{ yaw: 164.5285186767578,
  pitch: -6.635251045227051,
  roll: 3.231848955154419 }
{ yaw: 163.763427734375,
  pitch: -6.659839153289795,
  roll: 2.655540943145752 }
{ yaw: 164.1026153564453,
  pitch: -6.485481262207031,
  roll: 2.9403600692749023 }
</code></pre>

<h3 id="javascript-example">JavaScript example</h3>
<p>Enhanced description of the <a href="../../src/js_test/test_imu.js">sample source code</a>.</p>
<p>First, define the address of the MATRIX Creator. In this case we make it be <code>127.0.0.1</code>
because we are connecting from the local host but it needs to be different if we
connect from another computer. There is also the base port reserved by CORE for
the IMU driver.</p>
<pre><code>var creator_ip = '127.0.0.1'
var creator_imu_base_port = 20013
</code></pre>

<p>Load the protocol buffers used in the example.</p>
<pre><code>var protoBuf = require(&quot;protobufjs&quot;)

// Parse proto file
var protoBuilder = protoBuf.loadProtoFile('../../protocol-buffers/malos/driver.proto')
// Parse matrix_malos package (namespace).
var matrixMalosBuilder = protoBuilder.build(&quot;matrix_malos&quot;)
</code></pre>

<p>Subscribe to the errors reported by the driver. </p>
<pre><code>var zmq = require('zmq')

var errorSocket = zmq.socket('sub')
errorSocket.connect('tcp://' + creator_ip + ':' + (creator_imu_base_port + 2))
errorSocket.subscribe('')
errorSocket.on('message', function(error_message) {
  process.stdout.write('Message received: IMU error: ' + error_message.toString('utf8') + &quot;\n&quot;)
});
</code></pre>

<p>All the drivers are configured using the message <code>DriverConfig</code> (see <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>).
This is what the message looks like if we omit the fields that are not used in this example.</p>
<pre><code>message DriverConfig {
  float delay_between_updates = 1;
  float timeout_after_last_ping = 2;
}
</code></pre>
<p>The following snippet is telling the driver to send an update each 2 seconds
and stop sending updates if it doesn't receive a keep-alive message for 6 seconds.</p>
<pre><code>var configSocket = zmq.socket('push')
configSocket.connect('tcp://' + creator_ip + ':' + creator_imu_base_port)

var driverConfigProto = new matrixMalosBuilder.DriverConfig

driverConfigProto.delay_between_updates = 2.0
driverConfigProto.timeout_after_last_ping = 6.0

configSocket.send(driverConfigProto.encode().toBuffer())
</code></pre>

<p>Where is where the updates are received by subscribing to the <code>data update port</code> of the driver.
The subscription is initiated by the line <code>updateSocket.subscribe('')</code>.</p>
<pre><code>var updateSocket = zmq.socket('sub')
updateSocket.connect('tcp://' + creator_ip + ':' + (creator_imu_base_port + 3))
updateSocket.subscribe('')
updateSocket.on('message', function(buffer) {
  var data = new matrixMalosBuilder.IMU.decode(buffer)
  console.log(data)
});
</code></pre>

<p>An empty keep-alive message is sent to the driver every 5 seconds to make sure it keeps
sending data updates.</p>
<pre><code>var pingSocket = zmq.socket('push')
pingSocket.connect('tcp://' + creator_ip + ':' + (creator_imu_base_port + 1))
process.stdout.write(&quot;Sending pings every 5 seconds&quot;);
pingSocket.send(''); // Ping the first time.
setInterval(function(){
  pingSocket.send('');
}, 5000);
</code></pre> 
        </div>
        <div class="toc-parent col-lg-2">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#inertial-measurement-unit-imu" class="nav-link active">
    Inertial Measurement Unit - IMU
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#0mq-port">
        0MQ Port
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#protocol-buffers">
        Protocol buffers
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#keep-alives">
        Keep-alives
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#errors">
        Errors
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#read">
        Read
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#javascript-example">
        JavaScript example
      </a>
    </li>
    
  </ul>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  </div>

  <footer class="container">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        <div class="col-sm-4">
          <h5>MATRIX</h5>
          <ul>
            <li>
              <a href="https://apps.matrix.one/" target="blank">Apps</a>
            </li>
            <li>
              <a href="/">Creator</a>
            </li>
            <li>
              <a href="/">Voice</a>
            </li>
            <!--<li>
              <a href="/">Store</a>
            </li>-->
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Learn</h5>
          <ul>
            <li>
              <a href="/">Blog</a>
            </li>
            <li>
              <a href="/">Community</a>
            </li>
            <li>
              <a href="/">Docs</a>
            </li>
            <li>
              <a href="/">MATRIX Ecosystem</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Social Network</h5>
          <ul>
            <li>
              <a href="/">Facebook</a>
            </li>
            <li>
              <a href="/">Twitter</a>
            </li>
            <li>
              <a href="/">YouTube</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <h5>Contact</h5>
      <ul>
        <li>
          <a href="mailto:contact@matrix.one">contact@matrix.one</a>
        </li>
        <li class="subscribe-box">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Subscribe for Updates">
            <button type="button" class="btn btn-success">Subscribe</button>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6 push-sm-6">
      <div class="utility-links">
        <a href="/">Terms of Service</a>
        <a href="/">Privacy Policy</a>
        <a href="/">Cookie Policy</a>
      </div>
    </div>
    <div class="col-sm-6 pull-sm-6">
      <a href="/" class="company-logo">
        <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
        <span>MATRIX</span>
      </a>
      <small class="copyright">
        2016 - 2017 &copy; MATRIX - All rights reserved
      </small>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../../../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>
<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GPIO MATRIX</title>
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../css/theme.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="https://matrix.one">
    <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar-menu">
    <ul class="navbar-nav ml-auto">
      <!-- <li class="nav-item">
        <a class="nav-link">
          For Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Creator
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Voice
        </a>
      </li>
      <li class="nav-item">
        <a href="https://apps.matrix.one/" target="blank" class="nav-link">
          Apps
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Store
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          OS
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link active">
          Developers
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="/img/english.png" alt="English">
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="#">
            <span>Português</span>
            <img src="/img/brazil.png" alt="Portuguese" />
          </a>
          <a class="dropdown-item" href="#">
            <span>Español</span>
            <img src="/img/spain.png" alt="Spanish" />
          </a>
        </div>
      </li> -->
    </ul>
  </div>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>GPIO</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../../../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <h3>Documentation</h3>
          <ul>
              

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../.." class="">
    Overview
  </a>
</li>


  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../setup/" class="">
    Device Setup
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-os/" class="">
    MATRIX OS
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/overview/" class="">
      Overview
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-os/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../" class="active">
    MATRIX CORE
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../examples/pytests/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../" class="active">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
    
    <li><a href="../everloop/" class="">Everloop</a></li>
        
    
    <li><a href="./" class="active">GPIO</a></li>
        
    
    <li><a href="../humidity/" class="">Humidity</a></li>
        
    
    <li><a href="../imu/" class="">IMU</a></li>
        
    
    <li><a href="../lirc/" class="">IR</a></li>
        
    
    <li><a href="../pressure/" class="">Pressure</a></li>
        
    
    <li><a href="../servo/" class="">Servo</a></li>
        
    
    <li><a href="../uv/" class="">UV</a></li>
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-hal/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/getting-started/installation/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/datasheets/creator/" class="">
      Boards
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/components/" class="">
      Components
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/tools/" class="">
      Tools
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/examples/alexa/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-hal/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../help/" class="">
    Support
  </a>
</li>


 
          </ul>
        </div>
        <div id="content"  class="col-lg-8">
           <h1 id="gpio">GPIO</h1>
<p>The GPIO driver on current version supports:<a href="https://github.com/matrix-io/matrix-creator-malos/blob/master/docs/gpio_diagram.jpg"><img src="https://github.com/matrix-io/matrix-creator-malos/blob/master/docs/gpio_diagram.jpg" align="right" width="420" ></a></p>
<ul>
<li>GPIO pin input</li>
<li>GPIO pin output</li>
<li>GPIO updates (state from all pins)</li>
</ul>
<p>The driver follows the <a href="../../#protocol">CORE protocol</a>.</p>
<h3 id="gpio-electrical-characteristics">GPIO electrical characteristics</h3>
<ul>
<li>GPIO voltage: 0.60-4.10 VDC (<a href="https://github.com/matrix-io/matrix-creator-quickstart/wiki/Data-Sheets">details</a>)</li>
<li>current 10mA max</li>
<li>all GPIO pins need pullups</li>
</ul>
<h3 id="0mq-port">0MQ Port</h3>
<pre><code>20049
</code></pre>

<h3 id="protocol-buffers">Protocol buffers</h3>
<pre><code class="javascript">// GPIO handler params
message GpioParams {
  // GPIO to config
  uint32 pin = 1;

  // GPIO mode input/output
  enum EnumMode {
    INPUT = 0;
    OUTPUT = 1;
  }
  EnumMode mode = 2;

  // GPIO value
  uint32 value = 3;

  // GPIO all values
  uint32 values = 4;
}
</code></pre>

<p>The message is defined in <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>.</p>
<h3 id="keep-alives">Keep-alives</h3>
<p>This driver needs keep-alive messages <a href="../../../index/#keep-alive-port">as specified in the CORE protocol</a>.
If you start sending keep-alive messages it will start returning data every second so you can omit the configuration for this device.</p>
<h3 id="errors">Errors</h3>
<p>This driver reports errors when an invalid configuration is sent.</p>
<h3 id="write">Write</h3>
<p>All pins on matrix creator start as inputs. For change to outputs the driver need message for each pin on OUTPUT mode. (see Javascript example below)</p>
<h3 id="read">Read</h3>
<p>The driver will send a serialized message of integer <em>values</em> which represents of state from all GPIO pins <a href="../gpio_diagram.jpg">see figure 1</a>. For example: <em>values=5</em> represents <em>101</em> (pin 0 on 1, pin 1 on 0 and pin 2 on 1).</p>
<p>This is a sample output given by the example described below.</p>
<pre><code class="bash">$ node test_gpio.js 
Sending pings every 5 seconds
==&gt; pin 0 set to: true
&lt;== GPIO pins register:  1
</code></pre>

<p>(pin0 set on true and GPIO register return values field on 1, only pin 0 set 1)</p>
<pre><code class="bash">$ node test_gpio.js 
Sending pings every 5 seconds
==&gt; pin 0 set to: true
&lt;== GPIO pins register:  101
</code></pre>

<p>(pin0 set on true and GPIO register return values field on 3 (binary 101) pin 0 on 1, pin 2 on 1 all then on 0)</p>
<h3 id="javascript-example">JavaScript example</h3>
<p>Enhanced description of the <a href="https://github.com/matrix-io/matrix-creator-malos/src/js_test/test_gpio.js">sample source code</a>.</p>
<p>First, define the address of the MATRIX Creator. In this case we make it be <code>127.0.0.1</code>
because we are connecting from the local host but it needs to be different if we
connect from another computer. There is also the base port reserved by CORE for
the Pressure driver.</p>
<pre><code class="javascript">var creator_ip = '127.0.0.1'
var creator_gpio_base_port = 20013 + 36
</code></pre>

<h4 id="load-the-protocol-buffers-used-in-the-example">Load the protocol buffers used in the example.</h4>
<pre><code class="javascript">var protoBuf = require(&quot;protobufjs&quot;);
// parse proto file
var protoBuilder = protoBuf.loadProtoFile('../../protocol-buffers/malos/driver.proto')
// Parse matrix_malos package (namespace).
var matrixMalosBuilder = protoBuilder.build(&quot;matrix_malos&quot;)
</code></pre>

<h4 id="subscribe-to-the-errors-reported-by-the-driver-optional">Subscribe to the errors reported by the driver (optional)</h4>
<pre><code class="javascript">var zmq = require('zmq')

var errorSocket = zmq.socket('sub')
errorSocket.connect('tcp://' + creator_ip + ':' + (creator_gpio_base_port + 2))
errorSocket.subscribe('')
errorSocket.on('message', function(error_message) {
  process.stdout.write('Message received: Pressure error: ' + error_message.toString('utf8') + &quot;\n&quot;)
});
</code></pre>

<h4 id="configure-gpio-pins-modes-and-set-values-for-gpio-outputs">Configure GPIO pins modes and set values for GPIO outputs:</h4>
<p>All the drivers are configured using the message <code>DriverConfig</code> (see <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>).</p>
<h5 id="output-mode">Output mode:</h5>
<p>instance driver config object </p>
<pre><code class="javascript">  var config = new matrixMalosBuilder.DriverConfig
</code></pre>

<p>with GpioParams proto message set GPIO 0 to output mode </p>
<pre><code class="javascript">  var gpio_cfg_cmd = new matrixMalosBuilder.GpioParams
  gpio_cfg_cmd.set_pin(0)
  gpio_cfg_cmd.set_mode(matrixMalosBuilder.GpioParams.EnumMode.OUTPUT)
</code></pre>

<p>set GPIO pin value (0 or 1)</p>
<pre><code class="javascript">  gpio_cfg_cmd.set_value(1);
</code></pre>

<p>set on config driver params, encode and send</p>
<pre><code class="javascript">  config.set_gpio(gpio_cfg_cmd)
  configSocket.send(config.encode().toBuffer())
</code></pre>

<h5 id="input-mode">Input mode:</h5>
<p>instance driver config object </p>
<pre><code class="javascript">  var config = new matrixMalosBuilder.DriverConfig
</code></pre>

<p>set 250 ms between updates for example: (optional, default 1 second)</p>
<pre><code class="javascript">  config.delay_between_updates = .250
</code></pre>

<p>configure sending updates 2 seconds after pings (optional)</p>
<pre><code class="javascript">  config.timeout_after_last_ping = 2.0
</code></pre>

<p>with <code>GpioParams</code> for example set GPIO 1 to input mode:</p>
<pre><code class="javascript">  var gpio_cfg_cmd = new matrixMalosBuilder.GpioParams
  gpio_cfg_cmd.set_pin(1)
  gpio_cfg_cmd.set_mode(matrixMalosBuilder.GpioParams.EnumMode.INPUT)
</code></pre>

<p>set on config driver params, encode and send</p>
<pre><code class="javascript">  config.set_gpio(gpio_cfg_cmd)
  configSocket.send(config.encode().toBuffer())
</code></pre>

<h4 id="subscribe-to-gpio-updates">Subscribe to GPIO updates</h4>
<p>Where is where the updates are received by subscribing to the <code>data update port</code> of the driver.
The subscription is initiated by the line <code>updateSocket.subscribe('')</code>.</p>
<pre><code class="javascript">var updateSocket = zmq.socket('sub')
updateSocket.connect('tcp://' + creator_ip + ':' + (creator_gpio_base_port + 3))
updateSocket.subscribe('')
</code></pre>

<p>Register update callback:</p>
<pre><code class="javascript">updateSocket.on('message', function(gpio_buffer) {
  var gpioData = new matrixMalosBuilder.GpioParams.decode(gpio_buffer)
  // output in binary format all 15 pins of GPIO
  console.log('&lt;== GPIO pins register: ',dec2bin(gpioData.values))
});
</code></pre>

<p>The driver will send on callback a serialized message of integer <em>values</em> which represents of state from all GPIO pins</p>
<h4 id="keep-alive-messages">Keep-alive messages</h4>
<p>An empty keep-alive message is sent to the driver every 2 seconds to make sure it keeps
sending data updates.</p>
<pre><code class="javascript">var pingSocket = zmq.socket('push')
pingSocket.connect('tcp://' + creator_ip + ':' + (creator_gpio_base_port + 1))
// Ping the first time.
pingSocket.send(''); 
// Ping every 2 seconds (same to delay between updates)
setInterval(function() {
  pingSocket.send(''); // ping for new updates
}, 2000);
</code></pre> 
        </div>
        <div class="toc-parent col-lg-2">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#gpio" class="nav-link active">
    GPIO
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#gpio-electrical-characteristics">
        GPIO electrical characteristics
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#0mq-port">
        0MQ Port
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#protocol-buffers">
        Protocol buffers
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#keep-alives">
        Keep-alives
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#errors">
        Errors
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#write">
        Write
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#read">
        Read
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#javascript-example">
        JavaScript example
      </a>
    </li>
    
  </ul>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  </div>

  <footer class="container">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        <div class="col-sm-4">
          <h5>MATRIX</h5>
          <ul>
            <!-- <li>
              <a href="https://matrix.one/products/home">For Home</a>
            </li>
            <li>
              <a href="https://matrix.one/products/creator">Creator</a>
            </li>
            <li>
              <a href="https://matrix.one/products/voice">Voice</a>
            </li> -->
            <li>
              <a href="https://matrix.one/">For Home</a>
            </li>
            <li>
              <a href="https://creator.matrix.one/">Creator</a>
            </li>
            <!-- <li>
              <a href="https://matrix.one/products/voice">Voice</a>
            </li> -->

            <li>
              <a href="https://apps.matrix.one/" target="blank">Apps</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Learn</h5>
          <ul>
            <li>
              <a href="http://blog.matrix.one/" target="blank">Blog</a>
            </li>
            <li>
              <a href="http://community.matrix.one/" target="blank">Community</a>
            </li>
            <li>
              <a href="../../..">Docs</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Social Network</h5>
          <ul>
            <li>
              <a href="https://www.facebook.com/MATRIXCreator" target="blank">Facebook</a>
            </li>
            <li>
              <a href="https://twitter.com/matrix_creator" target="blank">Twitter</a>
            </li>
            <li>
              <a href="https://www.youtube.com/channel/UCBIqR8r0tfY6W-4-YpZ7NeQ" target="blank">YouTube</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <h5>Contact</h5>
      <ul>
        <li>
          <a href="mailto:contact@matrix.one">contact@matrix.one</a>
        </li>
        <!-- <li class="subscribe-box">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Subscribe for Updates">
            <button type="button" class="btn btn-success">Subscribe</button>
          </div>
        </li> -->
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <a href="https://matrix.one" class="company-logo">
        <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
        <span>MATRIX</span>
      </a>
      <small class="copyright">
        2017 &copy; MATRIX - All rights reserved
      </small>
    </div>
    <div class="col-sm-6">
      <div class="utility-links">
        <a href="https://matrix.one/policies/terms">Terms of Service</a>
        <a href="https://matrix.one/policies/privacy">Privacy Policy</a>
        <a href="https://matrix.one/policies/cookie">Cookie Policy</a>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../../../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>
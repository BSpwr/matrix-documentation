<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IR MATRIX</title>
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../css/theme.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="https://creator.matrix.one">
    <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar-menu">
    <ul class="navbar-nav ml-auto">
      <!-- <li class="nav-item">
        <a class="nav-link">
          For Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Creator
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Voice
        </a>
      </li>
      <li class="nav-item">
        <a href="https://apps.matrix.one/" target="blank" class="nav-link">
          Apps
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Store
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          OS
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link active">
          Developers
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="/img/english.png" alt="English">
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="#">
            <span>Português</span>
            <img src="/img/brazil.png" alt="Portuguese" />
          </a>
          <a class="dropdown-item" href="#">
            <span>Español</span>
            <img src="/img/spain.png" alt="Spanish" />
          </a>
        </div>
      </li> -->
    </ul>
  </div>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>IR</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../../../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <h3>Documentation</h3>
          <ul>
              

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../.." class="">
    Overview
  </a>
</li>


  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../setup/" class="">
    Device Setup
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-os/" class="">
    MATRIX OS
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/overview/" class="">
      Overview
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-os/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../" class="active">
    MATRIX CORE
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../examples/pytests/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../" class="active">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
    
    <li><a href="../everloop/" class="">Everloop</a></li>
        
    
    <li><a href="../gpio/" class="">GPIO</a></li>
        
    
    <li><a href="../humidity/" class="">Humidity</a></li>
        
    
    <li><a href="../imu/" class="">IMU</a></li>
        
    
    <li><a href="./" class="active">IR</a></li>
        
    
    <li><a href="../pressure/" class="">Pressure</a></li>
        
    
    <li><a href="../servo/" class="">Servo</a></li>
        
    
    <li><a href="../uv/" class="">UV</a></li>
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-hal/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/getting-started/installation/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/datasheets/creator/" class="">
      Boards
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/components/" class="">
      Components
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/tools/" class="">
      Tools
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/examples/alexa/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-hal/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../help/" class="">
    Support
  </a>
</li>


 
          </ul>
        </div>
        <div id="content"  class="col-lg-8">
           <h1 id="lirc">LIRC</h1>
<p>The LIRC driver on current version supports:</p>
<ul>
<li>IR send commands type <code>SEND_ONCE</code> for example: <code>SONY_XX BTN_MUTING</code></li>
<li>Multiple LIRC remote configurations concatenated via proto message. </li>
</ul>
<p>The driver follows the <a href="../../#protocol">CORE protocol</a>.</p>
<h3 id="lirc-driver-software">LIRC driver software:</h3>
<p>Actual CORE software layer use oficial LIRC <code>raspbian</code> package (0.9.0~pre1-1.2). The oficial documentation is for next version
but LIRC config files structure is the same. Please see it for details:</p>
<ul>
<li><a href="http://www.lirc.org/html/configuration-guide.html">http://www.lirc.org/html/configuration-guide.html</a>)</li>
</ul>
<h3 id="0mq-port">0MQ Port</h3>
<pre><code>20041
</code></pre>

<h3 id="protocol-buffers">Protocol buffers</h3>
<pre><code class="javascript">message LircParams {
  // IR remote device name
  string device = 1;

  // IR command
  string command = 2;

  //For transport of LIRC remote devices configuration.
  string config = 3;
}
</code></pre>

<p>The message is defined in <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>.</p>
<h3 id="keep-alives">Keep-alives</h3>
<p>This driver NOT needs keep-alive messages <a href="https:////github.com/matrix-io/matrix-creator-malos/blob/master/README.md#keep-alive-port">as specified in the CORE protocol</a>.</p>
<h3 id="errors">Errors</h3>
<p>This driver reports errors when an invalid configuration is sent.</p>
<h3 id="write">Write</h3>
<p>This driver need at last one LIRC remote configuration for send IR commands to any device. CORE LIRC driver support multiple remote controls in the same file and you can use a previous remote control recorded. You will can download this remotes config from MATRIX assets repository and then send it via <code>config</code> field of <code>LircParams</code> protobuf. For more details plese see JavaScript example described below.</p>
<p><strong>Example for SONY RM-AAU014</strong>:
<a href="" title="http://assets.admobilize.com/lirc-remotes/sony/RM-AAU014.lircd.conf">http://assets.admobilize.com/lirc-remotes/sony/RM-AAU014.lircd.conf</a></p>
<h3 id="read">Read</h3>
<p>This driver doesn't any data using CORE protocol. It only executes commands and sets configurations.</p>
<p>This is a sample output given by the example described below.</p>
<pre><code class="bash">$ node test_ir_remote.js 

downloading remote config..done.
set remote to config..done.
sending IR command: BTN_MUTING to SONY_RM device..done.
sending IR command: BTN_MUTING to SONY_RM device..done.
sending IR command: BTN_MUTING to SONY_RM device..done.
</code></pre>

<p><code>test_ir_remote</code> code first downloading remote config example then set it in CORE layer and then send IR commands</p>
<h3 id="javascript-example">JavaScript example</h3>
<p>Enhanced description of the <a href="../../src/js_test/test_ir_remote.js">sample source code</a>.</p>
<p>First, define the address of the MATRIX Creator. In this case we make it be <code>127.0.0.1</code>
because we are connecting from the local host but it needs to be different if we
connect from another computer. There is also the base port reserved by CORE for
the Pressure driver.</p>
<pre><code class="javascript">var creator_ip = '127.0.0.1'
var creator_pressure_base_port = 20013 + 28
</code></pre>

<h4 id="load-the-protocol-buffers-used-in-the-example">Load the protocol buffers used in the example.</h4>
<pre><code class="javascript">var protoBuf = require(&quot;protobufjs&quot;);
// parse proto file
var protoBuilder = protoBuf.loadProtoFile('../../protocol-buffers/malos/driver.proto')
// Parse matrix_malos package (namespace).
var matrixMalosBuilder = protoBuilder.build(&quot;matrix_malos&quot;)
</code></pre>

<h4 id="subscribe-to-the-errors-reported-by-the-driver-optional">Subscribe to the errors reported by the driver (optional)</h4>
<pre><code class="javascript">var zmq = require('zmq')

var errorSocket = zmq.socket('sub')
errorSocket.connect('tcp://' + creator_ip + ':' + (creator_lirc_base_port + 2))
errorSocket.subscribe('')
errorSocket.on('message', function(error_message) {
  process.stdout.write('Message received: Pressure error: ' + error_message.toString('utf8') + &quot;\n&quot;)
});
</code></pre>

<h4 id="downloading-some-remote-control">Downloading some remote control</h4>
<p>CORE Lirc driver support multiple remote controls in the same file. You can use a previous remote control recorded
and downloading it from MATRIX assets repository like this:</p>
<pre><code class="javascript">var http = require('http');
var fs = require('fs');

var remote_url=&quot;http://assets.admobilize.com/lirc-remotes/sony/RM-AAU014.lircd.conf&quot;
var remote_output=&quot;RM-AAU014.lircd.conf&quot;

function download (url, dest, cb) {
  process.stdout.write('downloading remote config..')
  var file = fs.createWriteStream(dest);
  var request = http.get(url, function(response) {
    response.pipe(file);
    file.on('finish', function() {
      console.log('done.')
      file.close(cb(dest));
    });
  });
}
download(remote_url,remote_output,configRemote)
</code></pre>

<h4 id="config-remote-device-on-core-layer">Config remote device on CORE layer</h4>
<p>All the drivers are configured using the message <code>driverconfig</code> (see <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>).</p>
<pre><code class="javascript">function configRemote(config){
  process.stdout.write('set remote to config..')
  // read previous config file downloaded
  fs.readFile(config, 'utf8', function (err,data) {
      if (err) { return console.log(err); }
      // build proto message
      var ir_cfg_cmd = new matrixMalosBuilder.LircParams
      ir_cfg_cmd.set_config(data)
      // send message in config proto
      sendIRConfigProto(ir_cfg_cmd) 
      console.log('done.')
  });
}

// Generic config proto function
function sendIRConfigProto(ir_cfg){
  var config = new matrixMalosBuilder.DriverConfig
  config.set_lirc(ir_cfg)
  configSocket.send(config.encode().toBuffer());
}
</code></pre>

<h4 id="send-remote-commands-to-target-device">Send remote commands to target device</h4>
<p>You can use similar flow for sending commands via DriverConfig proto.</p>
<pre><code class="javascript">function sendIrCommand(device, command) {
  // build LircParams proto message
  var ir_cfg_cmd = new matrixMalosBuilder.LircParams
  // set device target like SONY device
  ir_cfg_cmd.set_device(device)
  // set device command like BTN_MUTING
  ir_cfg_cmd.set_command(command)
  sendIRConfigProto(ir_cfg_cmd) 
}

// Optional sending continous IR commands
function continousSendRemoteCommand(){
  setInterval(function() {
    process.stdout.write('sending IR command: BTN_MUTING to SONY_RM device..')
    sendIrCommand('SONY_RM-AAU014','BTN_MUTING') // check LED on MATRIX
    console.log('done.')
  }, 3000);
}
</code></pre> 
        </div>
        <div class="toc-parent col-lg-2">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#lirc" class="nav-link active">
    LIRC
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#lirc-driver-software">
        LIRC driver software:
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#0mq-port">
        0MQ Port
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#protocol-buffers">
        Protocol buffers
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#keep-alives">
        Keep-alives
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#errors">
        Errors
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#write">
        Write
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#read">
        Read
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#javascript-example">
        JavaScript example
      </a>
    </li>
    
  </ul>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  </div>

  <footer class="container">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        <div class="col-sm-4">
          <h5>MATRIX</h5>
          <ul>
            <!-- <li>
              <a href="https://matrix.one/products/home">For Home</a>
            </li>
            <li>
              <a href="https://matrix.one/products/creator">Creator</a>
            </li>
            <li>
              <a href="https://matrix.one/products/voice">Voice</a>
            </li> -->
            <li>
              <a href="https://matrix.one/">For Home</a>
            </li>
            <li>
              <a href="https://creator.matrix.one/">Creator</a>
            </li>
            <!-- <li>
              <a href="https://matrix.one/products/voice">Voice</a>
            </li> -->

            <li>
              <a href="https://apps.matrix.one/" target="blank">Apps</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Learn</h5>
          <ul>
            <li>
              <a href="http://blog.matrix.one/" target="blank">Blog</a>
            </li>
            <li>
              <a href="http://community.matrix.one/" target="blank">Community</a>
            </li>
            <li>
              <a href="../../..">Docs</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Social Network</h5>
          <ul>
            <li>
              <a href="https://www.facebook.com/MATRIXCreator" target="blank">Facebook</a>
            </li>
            <li>
              <a href="https://twitter.com/matrix_creator" target="blank">Twitter</a>
            </li>
            <li>
              <a href="https://www.youtube.com/channel/UCBIqR8r0tfY6W-4-YpZ7NeQ" target="blank">YouTube</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <h5>Contact</h5>
      <ul>
        <li>
          <a href="mailto:contact@matrix.one">contact@matrix.one</a>
        </li>
        <!-- <li class="subscribe-box">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Subscribe for Updates">
            <button type="button" class="btn btn-success">Subscribe</button>
          </div>
        </li> -->
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6">
      <a href="https://creator.matrix.one" class="company-logo">
        <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
        <span>MATRIX</span>
      </a>
      <small class="copyright">
        2017 &copy; MATRIX - All rights reserved
      </small>
    </div>
    <div class="col-sm-6">
      <div class="utility-links">
        <a href="https://www.admobilize.com/#!/policies/terms">Terms of Service</a>
        <a href="https://www.admobilize.com/#!/policies/privacy">Privacy Policy</a>
        <a href="https://www.admobilize.com/#!/policies/cookie">Cookie Policy</a>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../../../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>
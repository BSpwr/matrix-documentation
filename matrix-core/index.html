<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MATRIX CORE MATRIX</title>
  <link rel="shortcut icon" href="../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/theme.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="https://matrix.one">
    <img src="../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbar-menu">
    <ul class="navbar-nav ml-auto">
      <!-- <li class="nav-item">
        <a class="nav-link">
          For Home
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Creator
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Voice
        </a>
      </li>
      <li class="nav-item">
        <a href="https://apps.matrix.one/" target="blank" class="nav-link">
          Apps
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          Store
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link">
          OS
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link active">
          Developers
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <img src="/img/english.png" alt="English">
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="#">
            <span>Português</span>
            <img src="/img/brazil.png" alt="Portuguese" />
          </a>
          <a class="dropdown-item" href="#">
            <span>Español</span>
            <img src="/img/spain.png" alt="Spanish" />
          </a>
        </div>
      </li> -->
    </ul>
  </div>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>MATRIX CORE</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <h3>Documentation</h3>
          <ul>
              

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href=".." class="">
    Overview
  </a>
</li>


  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../setup/" class="">
    Device Setup
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../matrix-os/" class="">
    MATRIX OS
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-os/getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-os/overview/" class="">
      Overview
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-os/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-os/reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../matrix-os/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="./" class="active">
    MATRIX CORE
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="examples/pytests/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../matrix-hal/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-hal/getting-started/installation/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-hal/datasheets/creator/" class="">
      Boards
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-hal/components/" class="">
      Components
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-hal/tools/" class="">
      Tools
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../matrix-hal/examples/alexa/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../matrix-hal/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../help/" class="">
    Support
  </a>
</li>


 
          </ul>
        </div>
        <div id="content"  class="col-lg-8">
           <h1 id="matrix-core">MATRIX CORE</h1>
<p>MATRIX CORE provides <a href="https://developers.google.com/protocol-buffers/">Protobufs</a> over <a href="http://zeromq.org/">ZeroMQ</a>. An intended target for this layer is <a href="http://github.com/matrix-io/matrix-os">MATRIX Open System</a>. You can also use CORE to query sensors and control any MATRIX Device from any language that supports protocol buffers (version 3.X) and 0MQ. </p>
<p>Connections to CORE can be made both from localhost (127.0.0.1) and from remote computers that are in the same network.</p>
<h2 id="specification">Specification</h2>
<p>Our <a href="http://github.com/matrix-io/protocol-buffers">Protocol Buffer Specifications</a> are currently defined in <code>proto</code> files. Please use these files to inform your ZMQ payloads. More information can be found in the examples below.</p>
<h2 id="installation">Installation</h2>
<p>See <a href="getting-started/installation/">Installation</a></p>
<h2 id="examples">Examples</h2>
<ul>
<li>See <a href="examples/jstests/">Javascript Test Example</a></li>
<li>See <a href="examples/pytests/">Python Test Example</a></li>
</ul>
<h2 id="protocol">Protocol</h2>
<p>All the CORE drivers use the same protocol to interact with other programs. Drivers allow read-only,
write-only or read-write modes.</p>
<p>CORE uses 0MQ to transfer information from and to the client interfacing with it. Each CORE driver has a base 0MQ port.
This is the current list of base ports (This is printed by CORE when it is started from the console):</p>
<pre><code>Registered driver IMU with port 20013.
Registered driver Humidity with port 20017.
Registered driver Everloop with port 20021.
Registered driver Pressure with port 20025.
Registered driver UV with port 20029.
Registered driver ZigbeeBulb with port 20033.
Registered driver MicArray_Alsa with port 20037.
Registered driver Lirc with port 20041.
</code></pre>

<p>Each port reserves a range of 4 ports that are used for a driver. They are described in the following sections.</p>
<h3 id="base-port">Base port</h3>
<p>This is the first port of the driver and the one used to denote the <code>driver port</code>.
It is used to configure the device and it makes sense for the devices that support configuration.
It is a 0MQ PULL port.
To send a configuration you need to send a valid message (serialized to a string) for the given driver. For instance, the
Everloop driver (LED array) uses a configuration message to set the LEDs.</p>
<p>The message is named EverloopImage and it is in the file <a href="https://github.com/matrix-io/protocol-buffers/blob/master/malos/driver.proto">driver.proto</a>.
The message follows:</p>
<pre><code>message LedValue {
  uint32 red = 1;
  uint32 green = 2;
  uint32 blue = 3;
  uint32 white = 4;
}

// The led array.
message EverloopImage {
  repeated LedValue led = 1;
}
</code></pre>

<p>In order to turn all the LEDs RED you need to add 35 messages of type LedValue to the EverloopImage message.
Each of the LedValue messages would need to have the following values:</p>
<ul>
<li>red: 10</li>
<li>green: 0</li>
<li>blue: 0</li>
<li>white: 0</li>
</ul>
<p>The valid values for led intensities range from 0 to 255, but we set red to 10 because this value is bright enough.</p>
<p>Once the message of type Everloop Image is filled out it needs to be serialized as a string and sent to the 0MQ configuration port.</p>
<p>If invalid values are used for the LED values of the number of LED values inside of EverloopImage is not 35 the configuration will be discarded and an error message will be generated and sent to the error channel described below.</p>
<h3 id="error-port">Error port</h3>
<p>Programs can subscribe to the 0MQ error port. It is a PUSH port. The port number is obtained by adding 2 to the base port (Also known as driver port).
The errors are returned as strings but there's a pending task to change the error messages to a protocol buffer (<a href="https://github.com/matrix-io/matrix-creator-malos/issues/21">track issue</a>).
Please do not depend on errors reported as strings as we will change the errors to protocol buffers soon.</p>
<h3 id="keep-alive-port">Keep-alive port</h3>
<p>The port number is obtained by adding 1 to the base port (Also known as driver port). It is a PUSH port.</p>
<p>In order to save CPU power and other resources some drivers require applications to send pings to it in order to keep them alive.
For most driveres it means that the driver keeps sending updates as fast as they have been configured to do so.
The Everloop driver doesn't require keep-alive messages. The IMU driver does.</p>
<p>Drivers that need keep-alive messages can be configured using the message that is used for all the configurations.
The way to do it is set relevant field while doing other driver specific configuration (if this is required).</p>
<pre><code>
message DriverConfig {
  // Delay between updates. In seconds.
  float delay_between_updates = 1;
  // Timeout after last ping.
  float timeout_after_last_ping = 2;

  // More fields here -- Omitted.
}
</code></pre>

<p>The field timeout_after_last_ping defaults to 5 seconds and it can be set during driver configuration.
If a driver doesn't receive Clive messages after <code>timeout_after_last_ping</code> seconds  it will stop sending updates.
This field is ignored by drivers that do not require keep alive messages. For instance, the Everloop driver ignores this setting.</p>
<p>After the setting is done (or not if the default value of 5 seconds is OK) you can start sending keepalive messages to the
driver by sending messages to the respective 0MQ port. Any message that is sent to this port will be discarded, so the
empty string "" makes for a good keep-alive message.</p>
<h3 id="data-update-port">Data update port</h3>
<p>The port number is obtained by adding 3 to the base port (Also known as driver port). This port is used by drivers that
send data (for instance Humidity and UV). Each driver uses a different message to report data to programs that subscribe
expecting updates.</p>
<p>Let's use the UV driver as an example. The relevant message:</p>
<pre><code>// Basic UV radiation lecture.
message UV{
  // UV index.
  float uv_index = 1;

  // Risk of harm from unprotected sun exposure, for the average adult.
  // According to the OMS table. https://www.epa.gov/sunsafety/uv-index-scale-0
  string oms_risk = 2;
}
</code></pre>

<p>Drivers that subscribe to updates via 0MQ will receive a string with serialized messages of type UV (within the matrix_malos namespace).
Then this message needs to be deserialized and the values can be used.</p>
<h3 id="workflow">Workflow</h3>
<p>Wrapping up the protocol section, a program that talks to CORE can:</p>
<ul>
<li>Configure a driver if needed. Or configure it many times if the drivers needs it.</li>
<li>Subscribe to error messages if it is interested in them.</li>
<li>Sends keep-alive messages if those are needed by the driver to remain active.</li>
<li>Subscribe to updates from the driver if the drivers produces them.</li>
</ul>
<h3 id="interfaces">Interfaces</h3>
<ul>
<li><a href="reference/everloop/">Everloop</a></li>
<li><a href="reference/humidity/">Humidity</a></li>
<li><a href="reference/imu/">IMU</a></li>
<li><a href="reference/lirc/">IR</a></li>
<li><a href="reference/pressure/">Pressure</a></li>
<li><a href="reference/uv/">UV</a></li>
<li><a href="reference/gpio/">GPIO</a></li>
</ul>
<h3 id="examples_1">Examples</h3>
<p><strong>Note:</strong> pre-requisite is NodeJS. Don't use the one shipped with Raspbian because it's a bit old. If you don't have it, please check a recipe included below.</p>
<pre><code>git clone https://github.com/matrix-io/matrix-creator-malos.git &amp;&amp; cd matrix-creator-malos
git submodule init &amp;&amp; git submodule update
cd src/js_test

// humidity, temperature
node test_humidity.js 

// inertial measurement unit
node test_imu.js 

// pressure, altitude
node test_pressure.js 

// uv index, uv range
node test_uv.js
</code></pre>

<hr />
<h3 id="history">History</h3>
<p>MATRIX CORE was previously packaged as MALOS and MALOS EYE.</p> 
        </div>
        <div class="toc-parent col-lg-2">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#matrix-core" class="nav-link active">
    MATRIX CORE
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#specification">
        Specification
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#installation">
        Installation
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#examples">
        Examples
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#protocol">
        Protocol
      </a>
    </li>
    
  </ul>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>
  </div>

  <footer class="container">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        <div class="col-sm-4">
          <h5>MATRIX</h5>
          <ul>
            <li>
              <a href="https://apps.matrix.one/" target="blank">Apps</a>
            </li>
            <li>
              <a href="/">Creator</a>
            </li>
            <li>
              <a href="/">Voice</a>
            </li>
            <!--<li>
              <a href="/">Store</a>
            </li>-->
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Learn</h5>
          <ul>
            <li>
              <a href="/">Blog</a>
            </li>
            <li>
              <a href="/">Community</a>
            </li>
            <li>
              <a href="/">Docs</a>
            </li>
            <li>
              <a href="/">MATRIX Ecosystem</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-4">
          <h5>Social Network</h5>
          <ul>
            <li>
              <a href="/">Facebook</a>
            </li>
            <li>
              <a href="/">Twitter</a>
            </li>
            <li>
              <a href="/">YouTube</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <h5>Contact</h5>
      <ul>
        <li>
          <a href="mailto:contact@matrix.one">contact@matrix.one</a>
        </li>
        <li class="subscribe-box">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Subscribe for Updates">
            <button type="button" class="btn btn-success">Subscribe</button>
          </div>
        </li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-6 push-sm-6">
      <div class="utility-links">
        <a href="/">Terms of Service</a>
        <a href="/">Privacy Policy</a>
        <a href="/">Cookie Policy</a>
      </div>
    </div>
    <div class="col-sm-6 pull-sm-6">
      <a href="/" class="company-logo">
        <img src="../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
        <span>MATRIX</span>
      </a>
      <small class="copyright">
        2016 - 2017 &copy; MATRIX - All rights reserved
      </small>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>
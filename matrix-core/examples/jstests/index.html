<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JavaScript MATRIX</title>
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../../css/theme.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="../../..">
    <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
  	<span class="navbar-toggler-icon"></span>
  </button>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>JavaScript</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../../../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <div class="collapse navbar-collapse" id="navbar-menu">
            <h3>Documentation</h3>
            <ul>
                

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../.." class="">
    Overview
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-creator/overview/" class="">
    MATRIX Creator
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-creator/overview/" class="">Overview</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-creator/device-setup/" class="">Device Setup</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-creator/resources/overview/" class="">
      Resources
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
      
  </ul>

   
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-voice/overview/" class="">
    MATRIX Voice
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-voice/overview/" class="">Overview</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-voice/device-setup/" class="">Device Setup</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-voice/esp32/" class="">ESP32</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-voice/resources/overview/" class="">
      Resources
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
      
  </ul>

   
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-os/" class="">
    MATRIX OS
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/overview/" class="">
      Overview
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-os/reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-os/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../" class="active">
    MATRIX CORE
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../getting-started/prerequisites/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../pytests/" class="active">
      Examples
    </a>
  </li>

  <ul class="subnav">
      
    
    <li><a href="../pytests/" class="">Python</a></li>
        
    
    <li><a href="./" class="active">JavaScript</a></li>
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../reference/" class="">
      Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../../matrix-hal/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../../matrix-hal/getting-started/installation/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
      
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../../matrix-hal/examples/hardware-demos/" class="">Sensor Tests</a></li>
    
</ul>

  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../../help/" class="">
    Support
  </a>
</li>


 
            </ul>
          </div>
        </div>
        <div id="content" class="col-lg-8 col-md-9">
           <h2 id="javascript-example">Javascript Example</h2>
<blockquote>
<p>You need <a href="https://nodejs.org/en/download/">NodeJS, and the Node Package Manager (npm)</a> installed on the Raspberry Pi.</p>
</blockquote>
<p>CORE is the program that sits between the low level hardware layer and MATRIX OS. This program allows MATRIX OS to access the board hardware via ZeroMQ sockets. You can also use it directly, as it is done with the examples below. The IPs are hardcoded in the examples to 127.0.0.1. Remember to edit them if you're accessing the Creator from another host and not from the Raspberry itself.</p>
<p>For an in-depth discussion of these tests, please examine the <a href="../../reference/">Reference</a> sections for JavaScript details.</p>
<h3 id="on-the-raspberry-pi">On the Raspberry Pi</h3>
<pre><code class="bash"># Install npm (doesn't really matter what version, apt-get node is v0.10...)
sudo apt-get install npm

# n is a node version manager
sudo npm install -g n

# node 6.5 is the latest target node version, also installs new npm
n 6.5

# check version
node -v
</code></pre>

<h2 id="download-and-prepare-core">Download and Prepare CORE</h2>
<pre><code class="bash">git clone https://github.com/matrix-io/matrix-creator-malos;
cd matrix-creator-malos;
git submodule update --init;
cd src/js_test;
npm install;
</code></pre>

<h1 id="using-core">Using CORE</h1>
<h3 id="core-examples">CORE Examples</h3>
<h5 id="connecting-to-core-with-nodejs">Connecting to CORE with NodeJS</h5>
<p><strong>Note:</strong> You'll need <code>protobufjs</code> and <code>zmq</code> npm packages, and protobuf as a submodule. See the <a href="https://github.com/matrix-io/matrix-creator-malos/blob/master/src/js_test/test_everloop.js">Everloop Example</a> for the full implementation of the code below.</p>
<pre><code class="js">// This is how we connect to the creator. IP and port.
// The IP is the IP I'm using and you need to edit it.
// By default, CORE has its 0MQ ports open to the world.

// Every device is identified by a base port. Then the mapping works
// as follows:
// BasePort     =&gt; Configuration port. Used to config the device.
// BasePort + 1 =&gt; Keepalive port. Send pings to this port.
// BasePort + 2 =&gt; Error port. Receive errros from device.
// BasePort + 3 =&gt; Data port. Receive data from device.

var protoBuf = require(&quot;protobufjs&quot;);
var zmq = require('zmq');
var configSocket = zmq.socket('push')

var creator_ip = '127.0.0.1'
var creator_everloop_base_port = 20013 + 8 // port for Everloop driver.

// relative to where you have the protobufs
var protoBuilder = protoBuf.loadProtoFile('../../protocol-buffers/malos/driver.proto')

// malos interface
var matrixMalosBuilder = protoBuilder.build(&quot;matrix_malos&quot;)
configSocket.connect('tcp://' + creator_ip + ':' + creator_everloop_base_port /* config */)

...
</code></pre>

<h5 id="passing-commands-to-core">Passing Commands to CORE</h5>
<p>Below is an example of Node interfacing with the Everloop via CORE. See the <a href="https://github.com/matrix-io/matrix-creator-malos/blob/master/src/js_test/test_everloop.js">Everloop Example</a> for the full implementation of the code below.</p>
<pre><code class="js">...

var max_intensity = 50
var intensity_value = max_intensity

function setEverloop() {
    var config = new matrixMalosBuilder.DriverConfig
    config.image = new matrixMalosBuilder.EverloopImage

    // Iteration over all 35 Everloop LEDs to turn them green.
    for (var j = 0; j &lt; 35; ++j) {
      var ledValue = new matrixMalosBuilder.LedValue;

      // set brightness/intensity of the color for each rgb LED.
      ledValue.setRed(0);
      ledValue.setGreen(intensity_value);
      ledValue.setBlue(0);
      ledValue.setWhite(0);
      config.image.led.push(ledValue);
    }
    configSocket.send(config.encode().toBuffer());
}

setEverloop(intensity_value)
setInterval(function() {
  intensity_value -= 1
  if (intensity_value &lt; 0)
    intensity_value = max_intensity
  setEverloop()
}, 10);
</code></pre>

<h5 id="reading-from-core">Reading from CORE</h5>
<p>Below is a simple implementation via NodeJS to read a <code>humidity</code> from CORE via 0MQ. See <a href="https://github.com/matrix-io/matrix-creator-malos/blob/master/src/js_test/test_humidity.js">Humidity Example</a> for the full example.</p>
<pre><code class="js">// Start configuration for refresh rate, and heartbeat timeouts
var configSocket = zmq.socket('push')
configSocket.connect('tcp://' + creator_ip + ':' + creator_humidity_base_port)
// Send driver configuration.
var driverConfigProto = new matrixMalosBuilder.DriverConfig
// 2 seconds between updates.
driverConfigProto.delay_between_updates = 2.0
// Stop sending updates 6 seconds after pings.
driverConfigProto.timeout_after_last_ping = 6.0
configSocket.send(driverConfigProto.encode().toBuffer())
// ********** End configuration.

// ********** Start updates - Here is where they are received.
var updateSocket = zmq.socket('sub')
updateSocket.connect('tcp://' + creator_ip + ':' + (creator_humidity_base_port + 3))
updateSocket.subscribe('')
updateSocket.on('message', function(buffer) {
  // read Humidity (or Pressure, Imu, UV, etc...) 
  var data = new matrixMalosBuilder.Humidity.decode(buffer)
  console.log(data)
});
// ********** End updates
</code></pre>

<h3 id="drivers">Drivers</h3>
<pre><code class="bash">node test_driver_info.js
</code></pre>

<h3 id="everloop">Everloop</h3>
<pre><code class="bash">node test_everloop.js
</code></pre>

<h3 id="humidity">Humidity</h3>
<pre><code class="bash">node test_humidity.js
</code></pre>

<h3 id="imu">IMU</h3>
<pre><code class="bash">node test_imu.js
</code></pre>

<h3 id="ir-remote">IR Remote</h3>
<pre><code class="bash">node test_ir_remote.js
</code></pre>

<h3 id="pressure">Pressure</h3>
<pre><code class="bash">node test_pressure.js
</code></pre>

<h3 id="uv">UV</h3>
<pre><code class="bash">node test_uv.js
</code></pre>

<h3 id="zigbee-bulb-onoff">Zigbee Bulb On/Off</h3>
<pre><code class="bash">node test_zigbee_bulb.js
</code></pre>

<h3 id="zigbee-bulb-color">Zigbee Bulb Color</h3>
<pre><code class="bash">node test_zigbee_color.js
</code></pre>

<h3 id="zigbee-bulb-brightness">Zigbee Bulb Brightness</h3>
<pre><code class="bash">node test_zigbee_level.js
</code></pre> 
        </div>
        <div class="toc-parent col-lg-2 col-md-3">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#javascript-example" class="nav-link active">
    Javascript Example
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#on-the-raspberry-pi">
        On the Raspberry Pi
      </a>
    </li>
    
  </ul>
  
</li>  <li class='nav-item'>
  <a href="#download-and-prepare-core" class="nav-link ">
    Download and Prepare CORE
  </a>
  
</li>  <li class='nav-item'>
  <a href="#using-core" class="nav-link ">
    Using CORE
  </a>
  
  <ul>
    
    <li>
      <a class="nav-link" href="#core-examples">
        CORE Examples
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#drivers">
        Drivers
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#everloop">
        Everloop
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#humidity">
        Humidity
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#imu">
        IMU
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#ir-remote">
        IR Remote
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#pressure">
        Pressure
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#uv">
        UV
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#zigbee-bulb-onoff">
        Zigbee Bulb On/Off
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#zigbee-bulb-color">
        Zigbee Bulb Color
      </a>
    </li>
    
    <li>
      <a class="nav-link" href="#zigbee-bulb-brightness">
        Zigbee Bulb Brightness
      </a>
    </li>
    
  </ul>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div class="row">
          <div class="col-sm-4">
            <h5>MATRIX</h5>
            <ul>
              <li>
                <a href="https://matrix.one/products/home" target="_blank">For Home</a>
              </li>
              <li>
                <a href="https://matrix.one/products/creator" target="_blank">Creator</a>
              </li>
              <li>
                <a href="https://matrix.one/products/voice" target="_blank">Voice</a>
              </li>
              <li>
                <a href="https://apps.matrix.one/" target="_blank">Apps</a>
              </li>
            </ul>
          </div>
          <div class="col-sm-4">
            <h5>Learn</h5>
            <ul>
              <li>
                <a href="http://blog.matrix.one/" target="_blank">Blog</a>
              </li>
              <li>
                <a href="http://community.matrix.one/" target="_blank">Community</a>
              </li>
              <li>
                <a href="../../..">Docs</a>
              </li>
            </ul>
          </div>
          <div class="col-sm-4">
            <h5>Social Network</h5>
            <ul>
              <li>
                <a href="https://www.facebook.com/MATRIXCreator" target="_blank">Facebook</a>
              </li>
              <li>
                <a href="https://twitter.com/matrix_creator" target="_blank">Twitter</a>
              </li>
              <li>
                <a href="https://www.youtube.com/channel/UCBIqR8r0tfY6W-4-YpZ7NeQ" target="_blank">YouTube</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <h5>Contact</h5>
        <ul>
          <li>
            <a href="https://matrix.one/contact">Contact Us</a>
          </li>
          <li class="subscribe-box">
            <form id="newsletter-form">
              <div class="input-group">
                <input id="newsletter-email" type="email" class="form-control" placeholder="Subscribe for Updates">
                <button type="submit" class="btn btn-success">Subscribe</button>
              </div>
              <label for="newsletter-email"></label>
            </form>
          </li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <a href="https://creator.matrix.one" class="company-logo">
          <img src="../../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
          <span>MATRIX</span>
        </a>
        <small class="copyright">
          2017 &copy; MATRIX - All rights reserved
        </small>
      </div>
      <div class="col-sm-6">
        <div class="utility-links">
          <a href="https://matrix.one/policies/terms">Terms of Service</a>
          <a href="https://matrix.one/policies/privacy">Privacy Policy</a>
          <a href="https://matrix.one/policies/cookie">Cookie Policy</a>
        </div>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../../../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>
  <script src="../../../js/jquery.ajaxchimp.min.js"></script>
  <script src="../../../js/jquery.ajaxchimp.langs.min.js"></script>
  <script src="../../../js/footer.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>